{
    "$schema": "http://json-schema.org/draft-07/schema#",
    "type": "object",
    "additionalProperties": false,
    "definitions": {
        "nativeErrorHandling": {
            "type": "object",
            "title": "Error handling strategy",
            "properties": {
                "onSubscribe": {
                    "$ref": "#/definitions/subscribeErrorHandling"
                },
                "onPublish": {
                    "$ref": "#/definitions/publishErrorHandling"
                }
            },
            "gioConfig": {
                "displayIf": {
                    "$eq": {
                        "context.apiType": ["NATIVE"]
                    }
                }
            }
        },
        "subscribeErrorHandling": {
            "type": "object",
            "title": "SubscribeErrorHandling",
            "description": "Error handling for subscribe phase",
            "oneOf": [
                {
                    "title": "Invalidate partition",
                    "properties": {
                        "strategy": {
                            "const": "INVALIDATE_PARTITION"
                        }
                    },
                    "required": ["strategy"]
                },
                {
                    "title": "Add record header",
                    "properties": {
                        "strategy": {
                            "const": "ADD_RECORD_HEADER"
                        },
                        "headerName": {
                            "title": "Record header name",
                            "description": "Record header name to append validation error",
                            "type": "string"
                        }
                    },
                    "required": ["strategy", "headerName"]
                }
            ],
            "gioConfig": {
                "displayIf": {
                    "$eq": {
                        "context.flowPhase": ["SUBSCRIBE"]
                    }
                }
            }
        },
        "publishErrorHandling": {
            "title": "PublishErrorHandling",
            "type": "object",
            "description": "Error handling for publish phase",
            "oneOf": [
                {
                    "title": "Fail with invalid record",
                    "properties": {
                        "strategy": {
                            "const": "FAIL_WITH_INVALID_RECORD"
                        }
                    },
                    "required": ["strategy"]
                }
            ],
            "gioConfig": {
                "displayIf": {
                    "$eq": {
                        "context.flowPhase": ["PUBLISH"]
                    }
                }
            }
        },
        "schemaSource": {
            "title": "SchemaSource",
            "type": "object",
            "description": "Schema source",
            "oneOf": [
                {
                    "title": "Static schema",
                    "properties": {
                        "sourceType": {
                            "const": "STATIC_SCHEMA"
                        },
                        "staticSchema": {
                            "title": "JSON Schema",
                            "description": "JSON Schema used for request payload validation",
                            "type": "string",
                            "format": "gio-code-editor",
                            "gioConfig": {
                                "monacoEditorConfig": {
                                    "language": "json"
                                }
                            }
                        }
                    },
                    "required": ["sourceType", "staticSchema"]
                },
                {
                    "title": "Schema registry",
                    "properties": {
                        "sourceType": {
                            "const": "SCHEMA_REGISTRY_RESOURCE"
                        },
                        "resourceName": {
                            "title": "Resource name",
                            "description": "Name of the schema registry resource",
                            "type": "string"
                        },
                        "schemaMapping": {
                            "title": "Schema mapping",
                            "description": "EL that evaluates to schema subject",
                            "type": "string"
                        }
                    },
                    "required": ["sourceType", "resourceName", "schemaMapping"]
                }
            ]
        }
    },
    "properties": {
        "scope": {
            "title": "Scope",
            "description": "Execute policy on <strong>request content</strong> or <strong>response content</strong> phase.",
            "type": "string",
            "default": "REQUEST_CONTENT",
            "enum": ["REQUEST_CONTENT", "RESPONSE_CONTENT"],
            "deprecated": true
        },
        "errorMessage": {
            "title": "Http error message",
            "description": "Http error message to send when request is not valid. Status code is 400 as Bad request for REQUEST scope. Status code is 500 as Internal Error for RESPONSE scope (without straight respond mode). e.g: {\"error\":\"Bad request\"}",
            "type": "string",
            "format": "gio-code-editor",
            "gioConfig": {
                "monacoEditorConfig": {
                    "language": "json"
                },
                "displayIf": {
                    "$eq": {
                        "context.apiType": ["MESSAGE", "PROXY"]
                    }
                }
            },
            "x-schema-form": {
                "type": "codemirror",
                "codemirrorOptions": {
                    "placeholder": "Put your error message here or drag'n'drop it",
                    "lineWrapping": true,
                    "lineNumbers": true,
                    "allowDropFileTypes": true,
                    "autoCloseTags": true,
                    "mode": "json",
                    "value": "{\"error\":\"Bad request\"}"
                },
                "expression-language": true
            }
        },
        "schema": {
            "title": "JSON Schema",
            "description": "JSON Schema used for request payload validation",
            "type": "string",
            "deprecated": true,
            "x-schema-form": {
                "type": "codemirror",
                "codemirrorOptions": {
                    "placeholder": "Put your json schema here or drag'n'drop it",
                    "lineWrapping": true,
                    "lineNumbers": true,
                    "allowDropFileTypes": true,
                    "autoCloseTags": true,
                    "mode": "javascript"
                }
            },
            "format": "gio-code-editor",
            "gioConfig": {
                "monacoEditorConfig": {
                    "language": "json"
                }
            }
        },
        "schemaSource": {
            "$ref": "#/definitions/schemaSource",
            "x-schema-form": {
                "hidden": true
            }
        },
        "nativeErrorHandling": {
            "$ref": "#/definitions/nativeErrorHandling",
            "x-schema-form": {
                "hidden": true
            }
        },
        "validateUnchecked": {
            "title": "Validate unchecked",
            "description": "Unchecked validation means that conditions which would normally cause the processing to stop with an exception are instead inserted into the resulting report. Warning: this means that anomalous events like an unresolvable JSON Reference, or an invalid schema, are masked!",
            "type": "boolean"
        },
        "deepCheck": {
            "title": "Deep check",
            "description": "Instructs the validator as to whether it should validate children even if the container (array or object) fails to validate.",
            "type": "boolean"
        },
        "straightRespondMode": {
            "title": "Straight respond mode",
            "description": "Only for RESPONSE scope. Straight respond mode means that responses failed to validate still will be sent to user without replacement. Validation failures messages are still being written to the metrics for further inspection.",
            "type": "boolean"
        }
    }
}
